import streamlit as st
import pandas as pd

# ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
st.set_page_config(page_title="Dashboard ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì", layout="wide")

# (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢)
st.markdown("""
<style>
@import url('https://fonts.googleapis.com/css2?family=Sarabun&display=swap');
html, body, [class*="css"] {
    font-family: 'Sarabun', sans-serif;
}
</style>
""", unsafe_allow_html=True)

# ‚úÖ ‡πÄ‡∏°‡∏ô‡∏π Slide Bar
selected_menus = st.sidebar.multiselect("üìå ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ Dashboard", [
    "1Ô∏è‚É£ ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®/‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á",
    "2Ô∏è‚É£ ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô (‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á)",
    "3Ô∏è‚É£ ‡∏á‡∏ö‡∏Å‡∏•‡∏≤‡∏á",
    "4Ô∏è‚É£ ‡πÅ‡∏ú‡∏ô‡∏ö‡∏π‡∏£‡∏ì‡∏≤‡∏Å‡∏≤‡∏£",
    "5Ô∏è‚É£ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î",
    "6Ô∏è‚É£ ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏±‡∏ê‡∏™‡∏†‡∏≤",
    "7Ô∏è‚É£ ‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠)",
    "8Ô∏è‚É£ ‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô)",
    "9Ô∏è‚É£ ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏á‡∏≤‡∏ô"  # ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡∏ô‡∏µ‡πâ
])



# ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
@st.cache_data
def load_data():
    file_path = "q4-68 August.xlsx"
    df = pd.read_excel(file_path, dtype=str, engine="openpyxl")
    num_cols = ["‡∏û‡∏£‡∏ö.", "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢", "%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"]
    df[num_cols] = df[num_cols].apply(pd.to_numeric, errors='coerce')
    df["‡∏û‡∏£‡∏ö."] = df["‡∏û‡∏£‡∏ö."] / 1_000_000
    df["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"] = df["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"] / 1_000_000
    df["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] = df["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] / 1_000_000
    df["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] = df["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] / 1_000_000
    return df

df = load_data()
if df.empty:
    st.error("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel")
    st.stop()

# ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß (‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡∏ó‡∏µ‡πà‡∏î‡∏π‡∏î‡∏µ‡∏ó‡∏±‡πâ‡∏á dark ‡πÅ‡∏•‡∏∞ light mode)
st.markdown("""
    <style>
    html, body, [class*="css"] {
        font-family: "Segoe UI", sans-serif;
    }
    .header-main {
        background-color: #AC1B1F;
        color: white;
        text-align: center;
        padding: 1rem;
        font-size: 30px;
        font-weight: 700;
        border-radius: 6px;
        margin-top: 2rem;
        margin-bottom: 0.5rem;
    }
    .header-sub {
        text-align: center;
        color: #AC1B1F;
        font-weight: 600;
        font-size: 25px;
        margin-bottom: 1.5rem;
    }
    .metric-label {
        font-size: 16px;
        color: gray;
    }
    .metric-value {
        font-size: 24px;
        font-weight: 600;
    }
    </style>
    <div class='header-main'>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡∏ì ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏° ‡∏û.‡∏®. 2568 (‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ‡∏ì ‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏° ‡∏û.‡∏®. 2568)</div>
""", unsafe_allow_html=True)
#-----------------------------


st.markdown(
    """
    <div style="text-align: right;">
        <a href="https://docs.google.com/forms/d/1Kt45668xXpCx07o_k_VuSK3uG7YejpQfyKhNIuOry8M/edit" target="_blank">
            <div style="display:inline-block; padding:0.3em 1em; background-color:#4CAF50; color:white; border-radius:8px; text-decoration:none; font-weight:normal;">
                ‡∏Ñ‡∏•‡∏¥‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏´‡πá‡∏ô‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏Ø
            </div>
        </a>
    </div>
    """,
    unsafe_allow_html=True
)

st.markdown("<br>", unsafe_allow_html=True)
st.markdown("""
<div style='text-align: left; font-size: 18px; font-weight: bold; margin-bottom: 10px;'>
 üîµ ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
</div>
""", unsafe_allow_html=True)

st.markdown("""
<div style='text-align: left; font-size: 14px; font-weight: normal; margin-bottom: 10px;'>
1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏£‡∏±‡∏ê ‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö New GFMIS Thai ‡∏Å‡∏£‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Å‡∏•‡∏≤‡∏á | ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ì ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ï‡πâ‡∏ô‡∏õ‡∏µ ‡∏á‡∏õ‡∏°. ‡∏ñ‡∏∂‡∏á‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏° ‡∏õ‡∏µ ‡∏á‡∏õ‡∏°. 2568 | ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ì ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 8 ‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô 2568
</div>
""", unsafe_allow_html=True)
st.markdown("""
<div style='text-align: left; font-size: 14px; font-weight: normal; margin-bottom: 10px;'>
2. ‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢ ‡∏Ñ‡∏∑‡∏≠ ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏ö‡∏¥‡∏Å‡πÅ‡∏ó‡∏ô‡πÉ‡∏´‡πâ 
</div>
""", unsafe_allow_html=True)
st.markdown("""
<div style='text-align: left; font-size: 14px; font-weight: normal; margin-bottom: 10px;'>
3. ‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ ‡∏Ñ‡∏∑‡∏≠ ‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô‡∏£‡∏ß‡∏° PO ‡∏£‡∏ß‡∏°‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡∏´‡∏ô‡∏µ‡πâ (‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢+PO+‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡∏´‡∏ô‡∏µ‡πâ)
</div>
""", unsafe_allow_html=True)
st.markdown("""
<div style='text-align: left; font-size: 14px; font-weight: normal; margin-bottom: 10px;'>
4. ‡∏™‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡πà‡∏≤ %‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞ %‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ "‡∏™‡∏µ‡πÅ‡∏î‡∏á" ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞ "‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß" ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
</div>
""", unsafe_allow_html=True)
st.markdown("<br>", unsafe_allow_html=True)


# ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á
st.markdown("""
<div style='text-align: left; font-size: 18px; font-weight: bold; margin-bottom: 10px;'>
 üîµ ‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡πà‡∏á‡∏£‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏Ñ‡∏£‡∏±‡∏ê ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡∏û.‡∏®. 2568 (‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢)
</div>
""", unsafe_allow_html=True)

html_table = """
<style>
table {
    border-collapse: collapse;
    width: 100%;
    font-size: 16px;
    margin: auto;
    text-align: center;
}
th, td {
    border: 1px solid black;
    padding: 8px;
    vertical-align: middle;
}
td.green-text {
    color: green;
    font-weight: bold;
}
</style>

<table>
    <tr>
        <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
        <th>‡∏ï.‡∏Ñ.-67</th><th>‡∏û.‡∏¢.-67</th><th>‡∏ò.‡∏Ñ.-67</th>
        <th>‡∏°.‡∏Ñ.-68</th><th>‡∏Å.‡∏û.-68</th><th>‡∏°‡∏µ.‡∏Ñ.-68</th>
        <th>‡πÄ‡∏°.‡∏¢.-68</th><th>‡∏û.‡∏Ñ.-68</th><th>‡∏°‡∏¥.‡∏¢.-68</th>
        <th>‡∏Å.‡∏Ñ.-68</th><th>‡∏™.‡∏Ñ.-68</th><th>‡∏Å.‡∏¢.-68</th>
    </tr>
    <tr>
        <td>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°_‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢</td>
        <td>9.00</td><td>18.00</td><td>27.00</td><td>35.67</td><td>44.33</td><td>53.00</td><td>60.33</td><td>67.67</td><td>75.00</td>
        <td>81.33</td><td class="green-text">87.67</td><td>94.00</td>
    </tr>
    <tr>
        <td>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°_‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</td>
        <td>12.33</td><td>24.67</td><td>37.00</td><td>45.00</td><td>53.00</td><td>61.00</td><td>67.33</td><td>73.67</td><td>80.00</td>
        <td>86.67</td><td class="green-text">93.33</td><td>100.00</td>
    </tr>
    <tr>
        <td>‡∏õ‡∏£‡∏∞‡∏à‡∏≥_‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢</td>
        <td>11.67</td><td>23.33</td><td>35.00</td><td>42.33</td><td>49.67</td><td>57.00</td><td>64.67</td><td>72.33</td><td>80.00</td>
        <td>86.00</td><td class="green-text">92.00</td><td>98.00</td>
    </tr>
    <tr>
        <td>‡∏õ‡∏£‡∏∞‡∏à‡∏≥_‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</td>
        <td>12.00</td><td>24.00</td><td>36.00</td><td>43.33</td><td>50.67</td><td>58.00</td><td>65.67</td><td>73.33</td><td>81.00</td>
        <td>87.33</td><td class="green-text">93.67</td><td>100.00</td>
    </tr>
    <tr>
        <td>‡∏•‡∏á‡∏ó‡∏∏‡∏ô_‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢</td>
        <td>5.67</td><td>11.33</td><td>17.00</td><td>23.00</td><td>29.00</td><td>35.00</td><td>41.33</td><td>47.67</td><td>54.00</td>
        <td>62.67</td><td class="green-text">71.33</td><td>80.00</td>
    </tr>
    <tr>
        <td>‡∏•‡∏á‡∏ó‡∏∏‡∏ô_‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</td>
        <td>13.00</td><td>26.00</td><td>39.00</td><td>48.00</td><td>57.00</td><td>66.00</td><td>69.67</td><td>73.33</td><td>77.00</td>
        <td>84.67</td><td class="green-text">92.33</td><td>100.00</td>
    </tr>
</table>
"""

st.markdown(html_table, unsafe_allow_html=True)



st.markdown("""
<div style='text-align: left; font-size: 14px; font-weight: normal; margin-bottom: 10px;'>
‡∏ó‡∏µ‡πà‡∏°‡∏≤: ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡πÄ‡∏•‡∏Ç‡∏≤‡∏ò‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ì‡∏∞‡∏£‡∏±‡∏ê‡∏°‡∏ô‡∏ï‡∏£‡∏µ ‡∏î‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡∏ô‡∏£ 0505/‡∏ß 466 ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 25 ‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏° 2567
</div>
""", unsafe_allow_html=True)

st.markdown("""
<div style='text-align: left; font-size: 14px; font-weight: normal; margin-bottom: 10px;'>
‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™
</div>
""", unsafe_allow_html=True)

#--------------------------*************--------------------------
st.markdown("<br>", unsafe_allow_html=True)
import streamlit as st

st.markdown("""
<style>
.blink {
  animation: blinker 1s linear infinite;
}
@keyframes blinker {
  50% { opacity: 0; }
}
</style>

<div style='text-align: left; font-size: 24px; font-weight: bold; margin-bottom: 10px; color: red;'>
  <span class="blink">‚¨Ö </span>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏à‡∏≤‡∏Å‡πÅ‡∏ó‡πá‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢
</div>
""", unsafe_allow_html=True)


st.markdown("""
<div style='text-align: left; font-size: 14px; font-weight: bold; margin-bottom: 12px;'>
‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
</div>
""", unsafe_allow_html=True)
st.markdown("""
<div style='text-align: left; font-size: 14px; font-weight: normal; margin-bottom: 10px;'>
1. ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î‡∏™‡∏≤‡∏°‡∏à‡∏∏‡∏î‡∏°‡∏∏‡∏°‡∏ö‡∏ô‡∏Ç‡∏ß‡∏≤&nbsp;&nbsp;&nbsp;|&nbsp; 2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Settings"&nbsp;&nbsp;&nbsp;|&nbsp; 3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Choose app theme, colors and fronts"&nbsp;&nbsp;&nbsp;‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏µ‡πÄ‡∏≠‡∏á‡πÇ‡∏î‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Edit active theme"
</div>
""", unsafe_allow_html=True)
st.markdown("<br>", unsafe_allow_html=True)

#--------------------------------------------------------------
# üîß ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
def compute_summary(df):
    total_prb = round(df["‡∏û‡∏£‡∏ö."].sum(), 4)
    total_after = round(df["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"].sum(), 4)
    total_disb = round(df["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"].sum(), 4)
    total_spend = round(df["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"].sum(), 4)
    percent_disb = round((total_disb / total_after) * 100, 2) if total_after else 0
    percent_spend = round((total_spend / total_after) * 100, 2) if total_after else 0
    return total_prb, total_after, total_disb, percent_disb, total_spend, percent_spend

# üîß ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• metric ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏™‡∏µ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏Å‡∏•‡∏∏‡πà‡∏°
def show_metrics(data, title):
    prb, after, disb, per_disb, spend, per_spend = data
    st.markdown(f"### {title}")
    col1, col2, col3 = st.columns(3)

    # ‚úÖ ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏Å‡∏•‡∏∏‡πà‡∏°
    if title == "üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°":
        disb_threshold = 87.67
        spend_threshold = 93.33
    elif title == "üè¢ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥":
        disb_threshold = 92
        spend_threshold = 93.67
    elif title == "üèóÔ∏è ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô":
        disb_threshold = 71.33
        spend_threshold = 92.33
    else:
        disb_threshold = spend_threshold = 0

    def small_metric(label, value, is_percent=False, threshold=None):
        formatted = f"{value:,.2f}%" if is_percent else f"{value:,.4f}"
        color = (
            "#00FF9F" if is_percent and value >= threshold
            else "#FF4B4B" if is_percent
            else "inherit"
        )
        return f"""
            <div style='margin-bottom: 0.75rem;'>
                <div class='metric-label'>{label}</div>
                <div class='metric-value' style='color: {color};'>{formatted}</div>
            </div>
        """

    with col1:
        st.markdown(small_metric("‡∏û.‡∏£.‡∏ö.", prb), unsafe_allow_html=True)
        st.markdown(small_metric("‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", after), unsafe_allow_html=True)
    with col2:
        st.markdown(small_metric("‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", disb), unsafe_allow_html=True)
        st.markdown(small_metric("%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", per_disb, is_percent=True, threshold=disb_threshold), unsafe_allow_html=True)
    with col3:
        st.markdown(small_metric("‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢", spend), unsafe_allow_html=True)
        st.markdown(small_metric("%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢", per_spend, is_percent=True, threshold=spend_threshold), unsafe_allow_html=True)

#-----*********************************************************
#-----*********************************************************

# üîß ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÑ‡∏Æ‡πÑ‡∏•‡∏ï‡πå
def prepare_table(df_part, category="‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°"):
    df_part = df_part.groupby("‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô")[["‡∏û‡∏£‡∏ö.", "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"]].sum().reset_index()
    df_part["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] = (df_part["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] / df_part["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100
    df_part["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] = (df_part["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] / df_part["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100
    cols = ["‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", "‡∏û‡∏£‡∏ö.", "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢", "%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"]
    df_part = df_part[cols]

    def highlight(row):
        color_disb = get_color(row["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"], category, "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢")
        color_spend = get_color(row["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"], category, "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢")
        return ["", "", "", "", f"color: {color_disb}", "", f"color: {color_spend}"]

    styled_df = df_part.style.format({
        "‡∏û‡∏£‡∏ö.": "{:,.4f}",
        "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô": "{:,.4f}",
        "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": "{:,.4f}",
        "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": "{:,.4f}",
        "%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": "{:,.2f}%",
        "%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": "{:,.2f}%"
    }).apply(highlight, axis=1)

    return styled_df


# üîß ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡∏ï‡∏≤‡∏° DataFrame
def compute_summary(df):
    total_prb = df["‡∏û‡∏£‡∏ö."].sum()
    total_after = df["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"].sum()
    total_disb = df["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"].sum()
    total_spend = df["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"].sum()
    percent_disb = round((total_disb / total_after) * 100, 2) if total_after else 0
    percent_spend = round((total_spend / total_after) * 100, 2) if total_after else 0
    return total_prb, total_after, total_disb, percent_disb, total_spend, percent_spend

#---------------------------------------------------------------------------
# üîß ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
def get_color(value, category, target_type):
    """
    category: '‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°', '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥', '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô'
    target_type: '‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢' ‡∏´‡∏£‡∏∑‡∏≠ '‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢'
    """
    thresholds = {
        "‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°": {"‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": 87.67, "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": 93.33},
        "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥": {"‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": 92, "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": 93.67},
        "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô": {"‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": 71.33, "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": 92.33},
    }
    threshold = thresholds.get(category, {}).get(target_type, 0)
    return "#00FF9F" if value >= threshold else "#FF4B4B"
 
# üîπ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á
def show_ministry_table(df_subset, title, category):
    if df_subset.empty:
        st.info(f"‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö {title}")
        return

    df_grouped = df_subset.groupby("‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á", as_index=False)[
        ["‡∏û‡∏£‡∏ö.", "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"]
    ].sum(numeric_only=True)

    df_grouped["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] = round((df_grouped["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] / df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)
    df_grouped["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] = round((df_grouped["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] / df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)

    display_cols = ["‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á", "‡∏û‡∏£‡∏ö.", "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢", "%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"]

    # ‚úÖ ‡πÉ‡∏™‡πà‡∏™‡∏µ‡∏ï‡∏≤‡∏° threshold
    def highlight(row):
        c1 = get_color(row["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"], category, "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢")
        c2 = get_color(row["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"], category, "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢")
        return ["", "", "", "", f"color:{c1}", "", f"color:{c2}"]

    styled = df_grouped[display_cols].style.format({
        "‡∏û‡∏£‡∏ö.": "{:,.4f}",
        "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô": "{:,.4f}",
        "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": "{:,.4f}",
        "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": "{:,.4f}",
        "%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": "{:,.2f}%",
        "%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": "{:,.2f}%"
    }).apply(highlight, axis=1)

    st.markdown(f"### {title}")
    st.dataframe(styled, use_container_width=True)

#-----*********************************************************
# ‚úÖ ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡πÄ‡∏°‡∏ô‡∏π
if "1Ô∏è‚É£ ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®/‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á" in selected_menus:
    st.markdown("## 1Ô∏è‚É£‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®")

    # ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
    total_all = compute_summary(df)
    total_regular = compute_summary(df[df['‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô'] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥"])
    total_invest = compute_summary(df[df['‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô'] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"])

    # ‡πÅ‡∏™‡∏î‡∏á Metric
    show_metrics(total_all, "üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°")
    show_metrics(total_regular, "üè¢ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥")
    show_metrics(total_invest, "üèóÔ∏è ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô")
    st.markdown("<br>", unsafe_allow_html=True)

    
    # ----- ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ -----
    st.markdown("## üîµ ‚ö†Ô∏è(‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á) ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô")

    # ======================== üî¢ ‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ======================== #
    total_prb    = float(df["‡∏û‡∏£‡∏ö."].sum() or 0.0)                                # ‡∏£‡∏ß‡∏°‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡∏û.‡∏£.‡∏ö.
    total_trans  = float(df["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"].sum() or 0.0)                         # ‡∏£‡∏ß‡∏°‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô
    total_invest = float(
        df.loc[df["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô", "‡∏û‡∏£‡∏ö."].sum() or 0.0
    )                                                                             # ‡∏£‡∏ß‡∏°‡∏á‡∏ö‡∏•‡∏á‡∏ó‡∏∏‡∏ô

    # ‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏°‡∏ß‡∏î‡∏•‡∏á‡∏ó‡∏∏‡∏ô
    total_invest_disb = float(
        df.loc[df["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"].sum() or 0.0
    )
    total_invest_spend = float(
        df.loc[df["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"].sum() or 0.0
    )

    # ======================== üéØ ‡∏õ‡∏±‡∏î‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• ======================== #
    total_prb_disp          = round(total_prb, 4)
    total_trans_disp        = round(total_trans, 4)
    total_invest_disp       = round(total_invest, 4)
    total_invest_disb_disp  = round(total_invest_disb, 4)
    total_invest_spend_disp = round(total_invest_spend, 4)

    # ======================== üìä ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô (%) ======================== #
    ratio_invest_disb_prb    = round((total_invest_disb  / total_prb)   * 100, 2) if total_prb   else 0.0
    ratio_invest_disb_trans  = round((total_invest_disb  / total_trans) * 100, 2) if total_trans else 0.0
    ratio_invest_spend_prb   = round((total_invest_spend / total_prb)   * 100, 2) if total_prb   else 0.0
    ratio_invest_spend_trans = round((total_invest_spend / total_trans) * 100, 2) if total_trans else 0.0
    ratio_invest_prb         = round((total_invest       / total_prb)   * 100, 2) if total_prb   else 0.0
    
    # ======================== üìù ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏£‡∏∏‡∏õ ======================== #
    st.markdown(
        f"""
        ‡πÉ‡∏ô‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡∏û.‡∏®. 2568 ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô **{total_prb_disp:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó** 
        ‡∏°‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô **{total_trans_disp:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó** 
        ‡∏°‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô **{total_invest_disp:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó** 
        ‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô {ratio_invest_prb:,.2f}% ‡∏Ç‡∏≠‡∏á‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏≤ 20 (1) ‡πÅ‡∏´‡πà‡∏á‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏ö‡∏±‡∏ç‡∏ç‡∏±‡∏ï‡∏¥‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡∏±‡∏ê ‡∏û.‡∏®. 2561
        ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ê‡∏ö‡∏≤‡∏•‡∏ï‡∏±‡πâ‡∏á‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 20
        ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ
        """,
        unsafe_allow_html=True
    )

    # ======================== üìë ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á 3 ‡πÅ‡∏ñ‡∏ß x 2 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå ======================== #
    import pandas as pd

    display_df = pd.DataFrame(
        {
            "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": [
                f"{total_invest_disb:,.4f}",
                f"{ratio_invest_disb_prb:.2f}%",
                f"{ratio_invest_disb_trans:.2f}%",
            ],
            "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": [
                f"{total_invest_spend:,.4f}",
                f"{ratio_invest_spend_prb:.2f}%",
                f"{ratio_invest_spend_trans:.2f}%",
            ],
        },
        index=[
            "‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô (‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó)",
            "% ‡∏ï‡πà‡∏≠ ‡∏û.‡∏£.‡∏ö.",
            "% ‡∏ï‡πà‡∏≠ ‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô",
        ],
    )

    # ‡πÉ‡∏ä‡πâ st.table ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏á‡∏ó‡∏µ‡πà (‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô/‡πÑ‡∏°‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)
    #st.table(display_df)
    
    # ======================== üåü KPI CARDS (Large & Stylish) ======================== #
    # ‡∏ß‡∏≤‡∏á CSS ‡πÅ‡∏Ñ‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏û‡∏≠ (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Light/Dark)
    st.markdown("""
    <style>
      @media (prefers-color-scheme: light) {
        .kpi-card { background:#ffffff; color:#000; box-shadow:0 2px 6px rgba(0,0,0,0.08); }
      }
      @media (prefers-color-scheme: dark) {
        .kpi-card { background:#2b2b2b; color:#fff; box-shadow:0 2px 6px rgba(255,255,255,0.05); }
      }
      .kpi-card{
        padding:22px; border-radius:14px; border:1px solid rgba(128,128,128,.18);
        margin-bottom:16px; text-align:center;
      }
      .kpi-label{
        font-size:16px; font-weight:700; margin-bottom:8px; color:#8a8a8a;
        text-transform:uppercase; letter-spacing:.4px;
      }
      .kpi-value{ font-size:30px; font-weight:800; margin-bottom:10px; color:#00b4d8; }
      .kpi-sub{ font-size:15px; opacity:.95; }
    </style>
    """, unsafe_allow_html=True)

    # === ‡∏Å‡∏≤‡∏£‡πå‡∏î KPI: ‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢ / ‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ (‡∏•‡∏á‡∏ó‡∏∏‡∏ô) ===
    c1, c2 = st.columns(2)

    with c1:
        st.markdown(
            f"""
            <div class='kpi-card'>
              <div class='kpi-label'>‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô</div>
              <div class='kpi-value'>{total_invest_disb_disp:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó</div>
              <div class='kpi-sub'>
                % ‡∏ï‡πà‡∏≠ ‡∏û.‡∏£.‡∏ö.: <b>{ratio_invest_disb_prb:.2f}%</b> ‚Ä¢
                % ‡∏ï‡πà‡∏≠ ‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô: <b>{ratio_invest_disb_trans:.2f}%</b>
              </div>
            </div>
            """,
            unsafe_allow_html=True
        )
        st.progress(min(int(ratio_invest_disb_prb), 100))

    with c2:
        st.markdown(
            f"""
            <div class='kpi-card'>
              <div class='kpi-label'>‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô</div>
              <div class='kpi-value'>{total_invest_spend_disp:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó</div>
              <div class='kpi-sub'>
                % ‡∏ï‡πà‡∏≠ ‡∏û.‡∏£.‡∏ö.: <b>{ratio_invest_spend_prb:.2f}%</b> ‚Ä¢
                % ‡∏ï‡πà‡∏≠ ‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô: <b>{ratio_invest_spend_trans:.2f}%</b>
              </div>
            </div>
            """,
            unsafe_allow_html=True
        )
        st.progress(min(int(ratio_invest_spend_prb), 100))

    # ======================== üìù ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏£‡∏∏‡∏õ (Custom Font Size) ======================== #
    st.markdown("""
    <style>
      .summary-text {
        font-size:18px;        /* ‡∏Ç‡∏ô‡∏≤‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô */
        line-height:1.7;       /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ */
      }

    </style>
    """, unsafe_allow_html=True)

    st.markdown(
        f"""
        <div class="summary-text">
        ‚ú® <b>‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏Ç‡∏≠‡∏á PBO:</b><br><br>
        ‡πÅ‡∏°‡πâ‡∏ß‡πà‡∏≤‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡∏à‡∏∞‡∏ö‡∏±‡∏ç‡∏ç‡∏±‡∏ï‡∏¥‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ê‡∏ö‡∏≤‡∏•‡∏ï‡∏±‡πâ‡∏á‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 20 ‡∏Ç‡∏≠‡∏á‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ
        ‡πÅ‡∏ï‡πà‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏ö‡∏±‡∏ç‡∏ç‡∏±‡∏ï‡∏¥‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡∏û.‡∏®. 2561 
        ‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡πÑ‡∏õ‡∏à‡∏≤‡∏Å‡∏¢‡∏≠‡∏î‡∏ï‡∏≤‡∏°‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏ä‡∏ö‡∏±‡∏ç‡∏ç‡∏±‡∏ï‡∏¥<br>‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô 
        ‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á ‡∏û‡∏ö‡∏ß‡πà‡∏≤ <b>‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏î‡∏•‡∏á‡∏à‡∏≤‡∏Å‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 20 ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏≤‡∏Å</b><br><br>
        
        ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô ‡πÅ‡∏°‡πâ‡∏ß‡πà‡∏≤‡∏£‡∏±‡∏ê‡∏ö‡∏≤‡∏•‡∏à‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏Å‡∏é‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á 
        ‡πÅ‡∏ï‡πà‡πÉ‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® ‡πÅ‡∏•‡∏∞‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà 
        ‡∏ã‡∏∂‡πà‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏≤‡∏¢‡∏õ‡∏µ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≥<b>‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡∏ß‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏ä‡πâ‡∏≤ ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÄ‡∏™‡∏µ‡∏¢‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</b>
        </div>
        """,
        unsafe_allow_html=True
    )







    
    # üîµ ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á/‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á
    st.markdown("## üîµ ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á/‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á")

    # ======================== üîµ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏• ======================== #
    def summarize_ministry_text(df_subset, disb_thres, spend_thres):
        group_cols = ["‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á"]
        sum_cols = ["‡∏û‡∏£‡∏ö.", "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"]
        df_grouped = df_subset.groupby(group_cols, as_index=False)[sum_cols].sum(numeric_only=True)

        df_grouped["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] = round((df_grouped["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] / df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)
        df_grouped["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] = round((df_grouped["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] / df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)

        low_disb = df_grouped[df_grouped["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] < disb_thres]["‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á"].tolist()
        low_spend = df_grouped[df_grouped["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] < spend_thres]["‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á"].tolist()

        return len(df_grouped), len(low_disb), low_disb, len(low_spend), low_spend

    # üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
    total_all, num_low_disb_all, low_disb_all, num_low_spend_all, low_spend_all = summarize_ministry_text(
        df, disb_thres=87.67, spend_thres=93.33
    )

    # üè¢ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥
    df_regular = df[df["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥"]
    total_reg, num_low_disb_reg, low_disb_reg, num_low_spend_reg, low_spend_reg = summarize_ministry_text(
        df_regular, disb_thres=92, spend_thres=93.67
    )

    # üèóÔ∏è ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô
    df_invest = df[df["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"]
    total_inv, num_low_disb_inv, low_disb_inv, num_low_spend_inv, low_spend_inv = summarize_ministry_text(
        df_invest, disb_thres=71.33, spend_thres=92.33
    )

    # ======================== üîµ ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Dark/Light) ======================== #
    st.markdown("""
    <style>
    /* Light mode */
    @media (prefers-color-scheme: light) {
        .summary-box {
            background-color: #f9f9f9;
            color: #000000;
        }
        .recommend-box {
            background-color: #eaeaea;
            color: #000000;
        }
    }
    /* Dark mode */
    @media (prefers-color-scheme: dark) {
        .summary-box {
            background-color: #1E1E1E;
            color: #ffffff;
        }
        .recommend-box {
            background-color: #262626;
            color: #ffffff;
        }
    }
    .summary-box, .recommend-box {
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 15px;
    }
    </style>
    """, unsafe_allow_html=True)

    # ======================== üîµ ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏•‡∏±‡∏Å ======================== #
    st.markdown(f"""
    <div style='font-size:22px; font-weight:bold; margin-bottom:15px;'>
    üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Ç‡∏≠‡∏á‡∏£‡∏±‡∏ê  
    ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô {total_all} ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á/‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á ‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢
    </div>
    """, unsafe_allow_html=True)

    # ---- Block 1: ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° ----
    st.markdown(f"""
    <div class='summary-box'>
        <h3>üìä ‡πÉ‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</h3>
        <ul>
            <li><span style='color:red;'>‡∏°‡∏µ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <b>{num_low_disb_all}</b> ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á</span> 
                ‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà {", ".join(low_disb_all) if low_disb_all else "-"}</li>
            <li><span style='color:red;'>‡∏°‡∏µ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <b>{num_low_spend_all}</b> ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á</span> 
                ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà {", ".join(low_spend_all) if low_spend_all else "-"}</li>
        </ul>
    </div>
    """, unsafe_allow_html=True)

    # ---- Block 2: ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥ ----
    st.markdown(f"""
    <div class='summary-box'>
        <h3>üè¢ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥</h3>
        <ul>
            <li><span style='color:red;'>‡∏°‡∏µ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <b>{num_low_disb_reg}</b> ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á</span> 
                ‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà {", ".join(low_disb_reg) if low_disb_reg else "-"}</li>
            <li><span style='color:red;'>‡∏°‡∏µ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <b>{num_low_spend_reg}</b> ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á</span> 
                ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà {", ".join(low_spend_reg) if low_spend_reg else "-"}</li>
        </ul>
    </div>
    """, unsafe_allow_html=True)

    # ---- Block 3: ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô ----
    st.markdown(f"""
    <div class='summary-box'>
        <h3>üèóÔ∏è ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô</h3>
        <ul>
            <li><span style='color:red;'>‡∏°‡∏µ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <b>{num_low_disb_inv}</b> ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á</span> 
                ‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà {", ".join(low_disb_inv) if low_disb_inv else "-"}</li>
            <li><span style='color:red;'>‡∏°‡∏µ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <b>{num_low_spend_inv}</b> ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á</span> 
                ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà {", ".join(low_spend_inv) if low_spend_inv else "-"}</li>
        </ul>
    </div>
    """, unsafe_allow_html=True)

    # ---- Block 4: ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞ ----
    st.markdown("""
    <div class='recommend-box'>
        ‚ú® <b>‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞:</b>  
        ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á/‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏±‡∏ê‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ 
        ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏£‡πà‡∏á‡∏£‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏°‡∏≤‡∏ï‡∏£‡∏Å‡∏≤‡∏£‡∏Ø 
        ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 
        ‡∏ó‡∏±‡πâ‡∏á‡πÉ‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏î‡∏£‡πâ‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô
    </div>
    """, unsafe_allow_html=True)


    # ‚úÖ ‡∏õ‡∏∏‡πà‡∏° Tab 3 ‡∏õ‡∏∏‡πà‡∏°
    tab1, tab2, tab3 = st.tabs(["üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°", "üè¢ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥", "üèóÔ∏è ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"])
    with tab1:
        show_ministry_table(df, "üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°", "‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°")

    with tab2:
        df_regular = df[df["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥"]
        show_ministry_table(df_regular, "üè¢ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥", "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥")

    with tab3:
        df_invest = df[df["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"]
        show_ministry_table(df_invest, "üèóÔ∏è ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô", "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô")

#-----*********************************************************
#-----*********************************************************
# ‚úÖ SECTION 2: ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
if "2Ô∏è‚É£ ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô (‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á)" in selected_menus:
    st.markdown("## 2Ô∏è‚É£ ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô")

    # üîπ Dropdown ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á
    ministry_list = df["‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á"].dropna().unique()
    selected_ministry = st.selectbox("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á", sorted(ministry_list), key="ministry_section2")

    # üîπ Filter ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    df_min = df[df["‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á"] == selected_ministry]
    df_reg = df_min[df_min["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥"]
    df_inv = df_min[df_min["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"]

    # üîπ ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
    total_all = compute_summary(df_min)
    total_regular = compute_summary(df_reg)
    total_invest = compute_summary(df_inv)

    prb, after, disb, per_disb, spend, per_spend = total_all
    color_disb = get_color(per_disb, "‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢")
    color_spend = get_color(per_spend, "‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢")

    # üìù ‡∏Ñ‡∏≥‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏¢‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô (‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å Tabs)
    st.markdown(f"""
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ‡πÉ‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° **üìç{selected_ministry}** ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì **{prb:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó** ‡∏°‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á **{after:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó**  ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢ **{disb:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó**  (<span style="color:{color_disb}; font-weight:bold;">{per_disb:.2f}%</span> ‡∏Ç‡∏≠‡∏á‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô)  ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ **{spend:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó**  (<span style="color:{color_spend}; font-weight:bold;">{per_spend:.2f}%</span> ‡∏Ç‡∏≠‡∏á‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô) ‡∏ó‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ
""", unsafe_allow_html=True)

    # üîπ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥
    if not df_reg.empty:
        prb_r, after_r, disb_r, per_disb_r, spend_r, per_spend_r = total_regular
        color_disb_r = get_color(per_disb_r, "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢")
        color_spend_r = get_color(per_spend_r, "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢")
        st.markdown(f"""
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; **1. ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥** ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì **{prb_r:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó**  ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á **{after_r:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó**  ‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢ **{disb_r:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó** (<span style="color:{color_disb_r}; font-weight:bold;">{per_disb_r:.2f}%</span>)  ‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ **{spend_r:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó** (<span style="color:{color_spend_r}; font-weight:bold;">{per_spend_r:.2f}%</span>)
""", unsafe_allow_html=True)

    # üîπ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô
    if not df_inv.empty:
        prb_i, after_i, disb_i, per_disb_i, spend_i, per_spend_i = total_invest
        color_disb_i = get_color(per_disb_i, "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢")
        color_spend_i = get_color(per_spend_i, "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢")
        st.markdown(f"""
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; **2. ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô** ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì **{prb_i:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó**  ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á **{after_i:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó**  ‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢ **{disb_i:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó** (<span style="color:{color_disb_i}; font-weight:bold;">{per_disb_i:.2f}%</span>)  ‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ **{spend_i:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó** (<span style="color:{color_spend_i}; font-weight:bold;">{per_spend_i:.2f}%</span>)
""", unsafe_allow_html=True)

    # üîπ Tabs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    tab1, tab2, tab3 = st.tabs(["üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°", "üè¢ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥", "üèóÔ∏è ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"])

    with tab1:
        st.dataframe(prepare_table(df_min, category="‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°"), use_container_width=True)

    with tab2:
        if not df_reg.empty:
            st.dataframe(prepare_table(df_reg, category="‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥"), use_container_width=True)
        else:
            st.info("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥")

    with tab3:
        if not df_inv.empty:
            st.dataframe(prepare_table(df_inv, category="‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"), use_container_width=True)
        else:
            st.info("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô")


#--------------------------------------------------------------
# ‚úÖ SECTION 3: ‡∏á‡∏ö‡∏Å‡∏•‡∏≤‡∏á (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö sidebar)
if "3Ô∏è‚É£ ‡∏á‡∏ö‡∏Å‡∏•‡∏≤‡∏á" in selected_menus:
    st.markdown("## 3Ô∏è‚É£ ‡∏á‡∏ö‡∏Å‡∏•‡∏≤‡∏á")

    # üîπ Filter ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á "‡∏á‡∏ö‡∏Å‡∏•‡∏≤‡∏á"
    df_central = df[df["‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á"] == "‡∏á‡∏ö‡∏Å‡∏•‡∏≤‡∏á"].copy()

    # üîπ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏™‡πà‡∏™‡∏µ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    def highlight_central(row, disb_thres, spend_thres):
        color_disb = "#00FF9F" if row["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] >= disb_thres else "#FF4B4B"
        color_spend = "#00FF9F" if row["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] >= spend_thres else "#FF4B4B"
        return ["", "", "", "", f"color: {color_disb}", "", f"color: {color_spend}"]

    # üîπ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•
    def show_central_table(df_subset, disb_thres, spend_thres):
        df_grouped = df_subset.groupby("‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", as_index=False)[
            ["‡∏û‡∏£‡∏ö.", "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"]
        ].sum(numeric_only=True)

        df_grouped["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] = round((df_grouped["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] / df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)
        df_grouped["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] = round((df_grouped["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] / df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)

        display_cols = ["‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", "‡∏û‡∏£‡∏ö.", "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢", "%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"]

        styled = df_grouped[display_cols].style.format({
            "‡∏û‡∏£‡∏ö.": "{:,.4f}",
            "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô": "{:,.4f}",
            "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": "{:,.4f}",
            "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": "{:,.4f}",
            "%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": "{:,.2f}%",
            "%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": "{:,.2f}%"
        }).apply(lambda row: highlight_central(row, disb_thres, spend_thres), axis=1)

        st.dataframe(styled, use_container_width=True)

        # üî∏ ‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î
        total_prb = df_grouped["‡∏û‡∏£‡∏ö."].sum()
        total_after = df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"].sum()
        total_disb = df_grouped["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"].sum()
        total_spend = df_grouped["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"].sum()
        percent_disb = round((total_disb / total_after) * 100, 2) if total_after else 0
        percent_spend = round((total_spend / total_after) * 100, 2) if total_after else 0

        color_disb_text = "#00FF9F" if percent_disb >= disb_thres else "#FF4B4B"
        color_spend_text = "#00FF9F" if percent_spend >= spend_thres else "#FF4B4B"

        st.markdown(f"""
**‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô** | ‡∏û‡∏£‡∏ö.: **{total_prb:,.4f}** | ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô: **{total_after:,.4f}** | 
‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢: **{total_disb:,.4f}** | <span style='color:{color_disb_text}; font-weight:bold;'>%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢: {percent_disb:.2f}%</span> | 
‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢: **{total_spend:,.4f}** | <span style='color:{color_spend_text}; font-weight:bold;'>%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢: {percent_spend:.2f}%</span>
""", unsafe_allow_html=True)

    # üîπ Tabs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    tab1, tab2, tab3 = st.tabs(["üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°", "üè¢ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥", "üèóÔ∏è ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"])

    with tab1:
        show_central_table(df_central, disb_thres=87.67, spend_thres=93.33)

    with tab2:
        df_central_reg = df_central[df_central["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥"]
        if not df_central_reg.empty:
            show_central_table(df_central_reg, disb_thres=92, spend_thres=93.67)
        else:
            st.info("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥")

    with tab3:
        df_central_inv = df_central[df_central["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"]
        if not df_central_inv.empty:
            show_central_table(df_central_inv, disb_thres=71.33, spend_thres=92.33)
        else:
            st.info("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô")

    st.markdown("<br>", unsafe_allow_html=True)

#--------------------------------------------------------------
# ‚úÖ SECTION 4: ‡πÅ‡∏ú‡∏ô‡∏ö‡∏π‡∏£‡∏ì‡∏≤‡∏Å‡∏≤‡∏£
if "4Ô∏è‚É£ ‡πÅ‡∏ú‡∏ô‡∏ö‡∏π‡∏£‡∏ì‡∏≤‡∏Å‡∏≤‡∏£" in selected_menus:
    st.markdown("## 4Ô∏è‚É£ ‡πÅ‡∏ú‡∏ô‡∏ö‡∏π‡∏£‡∏ì‡∏≤‡∏Å‡∏≤‡∏£")

    # üîπ Filter ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏ö‡∏π‡∏£‡∏ì‡∏≤‡∏Å‡∏≤‡∏£
    df_plan = df[df["‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô"] == "‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏ö‡∏π‡∏£‡∏ì‡∏≤‡∏Å‡∏≤‡∏£"]
    df_reg = df_plan[df_plan["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥"]
    df_inv = df_plan[df_plan["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"]

    # üîπ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
    total_prb = df_plan["‡∏û‡∏£‡∏ö."].sum()
    total_after = df_plan["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"].sum()
    total_disb = df_plan["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"].sum()
    total_spend = df_plan["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"].sum()
    percent_disb = round((total_disb / total_after) * 100, 2) if total_after else 0
    percent_spend = round((total_spend / total_after) * 100, 2) if total_after else 0
    color_disb = "#00FF9F" if percent_disb >= 87.67 else "#FF4B4B"
    color_spend = "#00FF9F" if percent_spend >= 93.33 else "#FF4B4B"

    # üîπ ‡∏õ‡∏£‡∏∞‡∏à‡∏≥
    prb_r = df_reg["‡∏û‡∏£‡∏ö."].sum()
    after_r = df_reg["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"].sum()
    disb_r = df_reg["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"].sum()
    spend_r = df_reg["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"].sum()
    per_disb_r = round((disb_r / after_r) * 100, 2) if after_r else 0
    per_spend_r = round((spend_r / after_r) * 100, 2) if after_r else 0
    color_disb_r = "#00FF9F" if per_disb_r >= 92 else "#FF4B4B"
    color_spend_r = "#00FF9F" if per_spend_r >= 93.67 else "#FF4B4B"

    # üîπ ‡∏•‡∏á‡∏ó‡∏∏‡∏ô
    prb_i = df_inv["‡∏û‡∏£‡∏ö."].sum()
    after_i = df_inv["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"].sum()
    disb_i = df_inv["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"].sum()
    spend_i = df_inv["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"].sum()
    per_disb_i = round((disb_i / after_i) * 100, 2) if after_i else 0
    per_spend_i = round((spend_i / after_i) * 100, 2) if after_i else 0
    color_disb_i = "#00FF9F" if per_disb_i >= 71.33 else "#FF4B4B"
    color_spend_i = "#00FF9F" if per_spend_i >= 92.33 else "#FF4B4B"

    st.markdown("""<div style='text-align: left; font-size: 18px; font-weight: bold; margin-bottom: 10px;'>üîµ ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏ö‡∏π‡∏£‡∏ì‡∏≤‡∏Å‡∏≤‡∏£</div>""", unsafe_allow_html=True)

    st.markdown(f"""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ‡πÉ‡∏ô‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡∏û.‡∏®. 2568 ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö**üìç‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏ö‡∏π‡∏£‡∏ì‡∏≤‡∏Å‡∏≤‡∏£ ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô {total_prb:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó** ‡∏°‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á **‡∏à‡∏≥‡∏ô‡∏ß‡∏ô {total_after:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó**  ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢ **‡∏à‡∏≥‡∏ô‡∏ß‡∏ô {total_disb:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó** (‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô <span style="color:{color_disb}; font-weight:bold;">{percent_disb:.2f}%</span> ‡∏Ç‡∏≠‡∏á ‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô) ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ **‡∏à‡∏≥‡∏ô‡∏ß‡∏ô {total_spend:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó** (‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô <span style="color:{color_spend}; font-weight:bold;">{percent_spend:.2f}%</span> ‡∏Ç‡∏≠‡∏á ‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô) ‡∏ó‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ""", unsafe_allow_html=True)

    if not df_reg.empty:
        st.markdown(f"""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**1. ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥** ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô **{prb_r:,.4f}** ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó ‡∏°‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô **{after_r:,.4f}** ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢  **{disb_r:,.4f}** ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó (‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô <span style="color:{color_disb_r}; font-weight:bold;">{per_disb_r:.2f}%</span> ‡∏Ç‡∏≠‡∏á ‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô) ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô **{spend_r:,.4f}** ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó (‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô <span style="color:{color_spend_r}; font-weight:bold;">{per_spend_r:.2f}%</span> ‡∏Ç‡∏≠‡∏á ‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô)""", unsafe_allow_html=True)

    if not df_inv.empty:
        st.markdown(f"""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**2. ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô** ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì **{prb_i:,.4f}** ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó ‡∏°‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô **{after_i:,.4f}** ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô **{disb_i:,.4f}** ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó (‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô <span style="color:{color_disb_i}; font-weight:bold;">{per_disb_i:.2f}%</span> ‡∏Ç‡∏≠‡∏á ‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô) ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô **{spend_i:,.4f}** ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó (‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô <span style="color:{color_spend_i}; font-weight:bold;">{per_spend_i:.2f}%</span> ‡∏Ç‡∏≠‡∏á ‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô)""", unsafe_allow_html=True)

    st.markdown("<br>", unsafe_allow_html=True)

    #--------------------------- ‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏¢‡πà‡∏≠‡∏¢ ---------------------------#
    st.markdown("""<div style='text-align: left; font-size: 18px; font-weight: bold; margin-bottom: 10px;'>üîµ ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏ö‡∏π‡∏£‡∏ì‡∏≤‡∏Å‡∏≤‡∏£</div>""", unsafe_allow_html=True)

    df_plan = df[df["‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô"] == "‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏ö‡∏π‡∏£‡∏ì‡∏≤‡∏Å‡∏≤‡∏£"].copy()
    plan_options = df_plan["‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô"].dropna().unique()
    selected_plan = st.selectbox("üîç‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô", sorted(plan_options))

    df_plan_selected = df_plan[df_plan["‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô"] == selected_plan]
    df_plan_reg = df_plan_selected[df_plan_selected["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥"]
    df_plan_inv = df_plan_selected[df_plan_selected["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"]

    def highlight_plan(row, disb_thres, spend_thres):
        color_disb = "#00FF9F" if row["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] >= disb_thres else "#FF4B4B"
        color_spend = "#00FF9F" if row["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] >= spend_thres else "#FF4B4B"
        return ["", "", "", "", f"color: {color_disb}", "", f"color: {color_spend}"]

    def show_plan_table(df_subset, title, disb_thres, spend_thres):
        group_cols = ["‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô"]
        sum_cols = ["‡∏û‡∏£‡∏ö.", "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"]
        df_grouped = df_subset.groupby(group_cols, as_index=False)[sum_cols].sum(numeric_only=True)
        df_grouped["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] = round((df_grouped["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] / df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)
        df_grouped["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] = round((df_grouped["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] / df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)
        display_cols = ["‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", "‡∏û‡∏£‡∏ö.", "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢", "%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"]
        styled = df_grouped[display_cols].style.format({
            "‡∏û‡∏£‡∏ö.": "{:,.4f}",
            "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô": "{:,.4f}",
            "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": "{:,.4f}",
            "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": "{:,.4f}",
            "%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": "{:,.2f}%",
            "%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": "{:,.2f}%"
        }).apply(lambda row: highlight_plan(row, disb_thres, spend_thres), axis=1)
        st.markdown(f"### {title}")
        st.dataframe(styled, use_container_width=True)

    # ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏ß‡∏°
    total_prb = df_plan_selected["‡∏û‡∏£‡∏ö."].sum()
    total_after = df_plan_selected["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"].sum()
    total_disb = df_plan_selected["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"].sum()
    total_spend = df_plan_selected["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"].sum()
    percent_disb = round((total_disb / total_after) * 100, 2) if total_after else 0
    percent_spend = round((total_spend / total_after) * 100, 2) if total_after else 0
    color_disb = "#00FF9F" if percent_disb >= 87.67 else "#FF4B4B"
    color_spend = "#00FF9F" if percent_spend >= 93.33 else "#FF4B4B"

    st.markdown(f"""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö**üìù{selected_plan}**  ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô **{total_prb:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó**  ‡∏°‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô **{total_after:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó**  ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô **{total_disb:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó**  (‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô <span style="color:{color_disb}; font-weight:bold;">{percent_disb:.2f}%</span> ‡∏Ç‡∏≠‡∏á ‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô)  ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô **{total_spend:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó**  (‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô <span style="color:{color_spend}; font-weight:bold;">{percent_spend:.2f}%</span> ‡∏Ç‡∏≠‡∏á ‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô) ‡∏ó‡∏±‡πâ‡∏á‡∏ô‡∏µ‡πâ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≥‡πÅ‡∏ô‡∏Å‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ""", unsafe_allow_html=True)

    if not df_plan_reg.empty:
        prb_r = df_plan_reg["‡∏û‡∏£‡∏ö."].sum()
        after_r = df_plan_reg["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"].sum()
        disb_r = df_plan_reg["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"].sum()
        spend_r = df_plan_reg["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"].sum()
        per_disb_r = round((disb_r / after_r) * 100, 2) if after_r else 0
        per_spend_r = round((spend_r / after_r) * 100, 2) if after_r else 0
        color_disb_r = "#00FF9F" if per_disb_r >= 92 else "#FF4B4B"
        color_spend_r = "#00FF9F" if per_spend_r >= 93.67 else "#FF4B4B"
        st.markdown(f"""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; **1. ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥** ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì **{prb_r:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó**  ‡∏°‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô **{after_r:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó**  ‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢ **{disb_r:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó**  (‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô <span style="color:{color_disb_r}; font-weight:bold;">{per_disb_r:.2f}%</span> ‡∏Ç‡∏≠‡∏á ‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô)  ‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ **{spend_r:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó**  (‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô <span style="color:{color_spend_r}; font-weight:bold;">{per_spend_r:.2f}%</span> ‡∏Ç‡∏≠‡∏á ‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô)""", unsafe_allow_html=True)

    if not df_plan_inv.empty:
        prb_i = df_plan_inv["‡∏û‡∏£‡∏ö."].sum()
        after_i = df_plan_inv["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"].sum()
        disb_i = df_plan_inv["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"].sum()
        spend_i = df_plan_inv["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"].sum()
        per_disb_i = round((disb_i / after_i) * 100, 2) if after_i else 0
        per_spend_i = round((spend_i / after_i) * 100, 2) if after_i else 0
        color_disb_i = "#00FF9F" if per_disb_i >= 71.33 else "#FF4B4B"
        color_spend_i = "#00FF9F" if per_spend_i >= 92.33 else "#FF4B4B"
        st.markdown(f"""&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; **2. ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô** ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì **{prb_i:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó**  ‡∏°‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô **{after_i:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó**  ‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢ **{disb_i:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó**  (‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô <span style="color:{color_disb_i}; font-weight:bold;">{per_disb_i:.2f}%</span> ‡∏Ç‡∏≠‡∏á ‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô)  ‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ **{spend_i:,.4f} ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó**  (‡∏Ñ‡∏¥‡∏î‡πÄ‡∏õ‡πá‡∏ô <span style="color:{color_spend_i}; font-weight:bold;">{per_spend_i:.2f}%</span> ‡∏Ç‡∏≠‡∏á ‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô)""", unsafe_allow_html=True)

    # ‚úÖ Tabs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    tab1, tab2, tab3 = st.tabs(["üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°", "üè¢ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥", "üèóÔ∏è ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"])

    # ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    def show_plan_table(df_subset, disb_thres, spend_thres):
        group_cols = ["‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô"]
        sum_cols = ["‡∏û‡∏£‡∏ö.", "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"]
        df_grouped = df_subset.groupby(group_cols, as_index=False)[sum_cols].sum(numeric_only=True)
        df_grouped["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] = round((df_grouped["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] / df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)
        df_grouped["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] = round((df_grouped["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] / df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)

        display_cols = ["‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", "‡∏û‡∏£‡∏ö.", "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢", "%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"]

        styled = df_grouped[display_cols].style.format({
            "‡∏û‡∏£‡∏ö.": "{:,.4f}",
            "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô": "{:,.4f}",
            "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": "{:,.4f}",
            "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": "{:,.4f}",
            "%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": "{:,.2f}%",
            "%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": "{:,.2f}%"
        }).apply(lambda row: highlight_plan(row, disb_thres, spend_thres), axis=1)

        st.dataframe(styled, use_container_width=True)

    # üìä Tab 1: ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
    with tab1:
        show_plan_table(df_plan_selected, disb_thres=87.67, spend_thres=93.33)

    # üè¢ Tab 2: ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥
    with tab2:
        if not df_plan_reg.empty:
            show_plan_table(df_plan_reg, disb_thres=92, spend_thres=93.67)
        else:
            st.info("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥")

    # üèóÔ∏è Tab 3: ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô
    with tab3:
        if not df_plan_inv.empty:
            show_plan_table(df_plan_inv, disb_thres=71.33, spend_thres=92.33)
        else:
            st.info("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô")


#--------------------------------------------------------------

# ‚úÖ SECTION 5: ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö sidebar)
if "5Ô∏è‚É£ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î" in selected_menus:
    st.markdown("## 5Ô∏è‚É£ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î")

    # üîπ Dropdown 1: ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î/‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
    province_options = df["‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î/‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î"].dropna().unique()
    selected_province = st.selectbox("üîç‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î/‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î", sorted(province_options))

    # üîπ Filter ‡∏ï‡∏≤‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
    df_province = df[df["‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î/‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î"] == selected_province]

    # üîπ Dropdown 2: ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
    agency_options = df_province["‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô"].dropna().unique()
    selected_agency = st.selectbox("üîç‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", sorted(agency_options))

    # üîπ Filter ‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
    df_agency = df_province[df_province["‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô"] == selected_agency]

    # üîπ Dropdown 3: ‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
    project_options = df_agency["‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£"].dropna().unique()
    selected_project = st.selectbox("üîç‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", sorted(project_options))

    # üîπ Filter ‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
    df_selected = df_agency[df_agency["‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£"] == selected_project]

    # üîπ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏™‡πà‡∏™‡∏µ
    def highlight_local(row, disb_thres, spend_thres):
        color_disb = "#00FF9F" if row["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] >= disb_thres else "#FF4B4B"
        color_spend = "#00FF9F" if row["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] >= spend_thres else "#FF4B4B"
        return ["", "", "", "", f"color: {color_disb}", "", f"color: {color_spend}"]

    # üîπ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    def show_local_table(df_subset, disb_thres, spend_thres):
        group_cols = ["‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì"]
        sum_cols = ["‡∏û‡∏£‡∏ö.", "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"]

        df_grouped = df_subset.groupby(group_cols, as_index=False)[sum_cols].sum(numeric_only=True)
        df_grouped["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] = round((df_grouped["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] / df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)
        df_grouped["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] = round((df_grouped["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] / df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)

        display_cols = ["‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì", "‡∏û‡∏£‡∏ö.", "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢", "%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"]

        styled = df_grouped[display_cols].style.format({
            "‡∏û‡∏£‡∏ö.": "{:,.4f}",
            "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô": "{:,.4f}",
            "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": "{:,.4f}",
            "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": "{:,.4f}",
            "%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": "{:,.2f}%",
            "%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": "{:,.2f}%"
        }).apply(lambda row: highlight_local(row, disb_thres, spend_thres), axis=1)

        st.dataframe(styled, use_container_width=True)

    # ‚úÖ Tabs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    tab1, tab2, tab3 = st.tabs(["üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°", "üè¢ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥", "üèóÔ∏è ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"])

    # üìä Tab 1: ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
    with tab1:
        show_local_table(df_selected, disb_thres=87.67, spend_thres=93.33)

    # üè¢ Tab 2: ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥
    with tab2:
        df_reg = df_selected[df_selected["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥"]
        if not df_reg.empty:
            show_local_table(df_reg, disb_thres=92, spend_thres=93.67)
        else:
            st.info("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥")

    # üèóÔ∏è Tab 3: ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô
    with tab3:
        df_inv = df_selected[df_selected["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"]
        if not df_inv.empty:
            show_local_table(df_inv, disb_thres=71.33, spend_thres=92.33)
        else:
            st.info("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô")

    st.markdown("<br>", unsafe_allow_html=True)


#--------------------------------------------------------------

# ‚úÖ SECTION 6: ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏±‡∏ê‡∏™‡∏†‡∏≤ (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö sidebar)
if "6Ô∏è‚É£ ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏±‡∏ê‡∏™‡∏†‡∏≤" in selected_menus:
    st.markdown("## 6Ô∏è‚É£ ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏±‡∏ê‡∏™‡∏†‡∏≤")

    # üîπ Filter ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏±‡∏ê‡∏™‡∏†‡∏≤
    df_parliament = df[df["‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á"] == "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏±‡∏ê‡∏™‡∏†‡∏≤"].copy()

    # üîπ Dropdown ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
    agency_options = df_parliament["‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô"].dropna().unique()
    selected_agency = st.selectbox("üîç‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", sorted(agency_options))

    # üîπ Filter ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    df_selected = df_parliament[df_parliament["‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô"] == selected_agency]

    # üîπ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏™‡πà‡∏™‡∏µ‡∏ï‡∏≤‡∏° threshold
    def highlight_parliament(row, disb_thres, spend_thres):
        color_disb = "#00FF9F" if row["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] >= disb_thres else "#FF4B4B"
        color_spend = "#00FF9F" if row["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] >= spend_thres else "#FF4B4B"
        return ["", "", "", "", f"color: {color_disb}", "", f"color: {color_spend}"]

    # üîπ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•
    def show_parliament_table(df_subset, disb_thres, spend_thres):
        df_grouped = df_subset.groupby("‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", as_index=False)[
            ["‡∏û‡∏£‡∏ö.", "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"]
        ].sum(numeric_only=True)

        df_grouped["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] = round((df_grouped["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] / df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)
        df_grouped["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] = round((df_grouped["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] / df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)

        display_cols = ["‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", "‡∏û‡∏£‡∏ö.", "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢", "%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"]

        styled = df_grouped[display_cols].style.format({
            "‡∏û‡∏£‡∏ö.": "{:,.4f}",
            "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô": "{:,.4f}",
            "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": "{:,.4f}",
            "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": "{:,.4f}",
            "%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": "{:,.2f}%",
            "%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": "{:,.2f}%"
        }).apply(lambda row: highlight_parliament(row, disb_thres, spend_thres), axis=1)

        st.dataframe(styled, use_container_width=True)

        # üî∏ ‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î
        total_prb = df_grouped["‡∏û‡∏£‡∏ö."].sum()
        total_after = df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"].sum()
        total_disb = df_grouped["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"].sum()
        total_spend = df_grouped["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"].sum()
        percent_disb = round((total_disb / total_after) * 100, 2) if total_after else 0
        percent_spend = round((total_spend / total_after) * 100, 2) if total_after else 0

        color_disb_text = "#00FF9F" if percent_disb >= disb_thres else "#FF4B4B"
        color_spend_text = "#00FF9F" if percent_spend >= spend_thres else "#FF4B4B"

        st.markdown(f"""
**‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô** | ‡∏û‡∏£‡∏ö.: **{total_prb:,.4f}** | ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô: **{total_after:,.4f}** | 
‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢: **{total_disb:,.4f}** | <span style='color:{color_disb_text}; font-weight:bold;'>%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢: {percent_disb:.2f}%</span> | 
‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢: **{total_spend:,.4f}** | <span style='color:{color_spend_text}; font-weight:bold;'>%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢: {percent_spend:.2f}%</span>
""", unsafe_allow_html=True)

    # ‚úÖ Tabs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    tab1, tab2, tab3 = st.tabs(["üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°", "üè¢ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥", "üèóÔ∏è ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"])

    # üìä Tab 1: ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
    with tab1:
        show_parliament_table(df_selected, disb_thres=87.67, spend_thres=93.33)

    # üè¢ Tab 2: ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥
    with tab2:
        df_par_reg = df_selected[df_selected["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥"]
        if not df_par_reg.empty:
            show_parliament_table(df_par_reg, disb_thres=92, spend_thres=93.67)
        else:
            st.info("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥")

    # üèóÔ∏è Tab 3: ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô
    with tab3:
        df_par_inv = df_selected[df_selected["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"]
        if not df_par_inv.empty:
            show_parliament_table(df_par_inv, disb_thres=71.33, spend_thres=92.33)
        else:
            st.info("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô")

    st.markdown("<br>", unsafe_allow_html=True)


#--------------------------------------------------------------
# ‚úÖ SECTION 7: ‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö slide bar)
if "7Ô∏è‚É£ ‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠)" in selected_menus:
    st.markdown("## 7Ô∏è‚É£ ‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£)")

    # üîç ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£
    search_text = st.text_input("üîç‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", "", key="search_project_section7")

    # üîé ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
    df_search = df[df["‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£"].str.contains(search_text, case=False, na=False)] if search_text else df

    # üß© ‡∏™‡∏£‡πâ‡∏≤‡∏á project_key ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏î‡∏ã‡πâ‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
    df_search["project_key"] = df_search["‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£"] + " | " + df_search["‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô"]

    # ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ project_key ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥
    project_options = df_search.drop_duplicates(subset=["project_key"])[["‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", "‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô"]]
    project_options["label"] = project_options["‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£"] + " | " + project_options["‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô"]

    # üîΩ Dropdown ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    selected_label = st.selectbox("üîç‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", project_options["label"].tolist())

    # üîé ‡πÅ‡∏¢‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    selected_project, selected_agency = selected_label.split(" | ", 1)

    # üîÑ Filter ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    df_project = df[
        (df["‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£"] == selected_project) &
        (df["‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô"] == selected_agency)
    ].copy()

    # üî¢ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì %‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢ ‡πÅ‡∏•‡∏∞ %‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢
    df_project["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] = round((df_project["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] / df_project["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)
    df_project["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] = round((df_project["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] / df_project["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)

    # üìå ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏£‡∏ß‡∏°
    if not df_project.empty:
        ministry_of_project = df_project["‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á"].iloc[0]
        total_prb_all = df_project["‡∏û‡∏£‡∏ö."].sum()
        total_after_all = df_project["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"].sum()

        st.markdown(f"""
        üìå ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏†‡∏≤‡∏¢‡πÉ‡∏ï‡πâ ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á: <span style='color:green; font-weight:bold;'>{ministry_of_project}</span> | ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô: <span style='color:green; font-weight:bold;'>{selected_agency}</span>  
        ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô <span style='font-weight:bold;'>{total_prb_all:,.4f}</span> ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô <span style='font-weight:bold;'>{total_after_all:,.4f}</span> ‡∏•‡πâ‡∏≤‡∏ô‡∏ö‡∏≤‡∏ó
        """, unsafe_allow_html=True)

    # üé® ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏™‡πà‡∏™‡∏µ
    def highlight_project(row, disb_thres, spend_thres):
        color_disb = "#00FF9F" if row["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] >= disb_thres else "#FF4B4B"
        color_spend = "#00FF9F" if row["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] >= spend_thres else "#FF4B4B"
        return ["", "", "", "", f"color: {color_disb}", "", f"color: {color_spend}"]

    # üìã ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á + ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î
    def show_project_table(df_sub, disb_thres, spend_thres):
        df_grouped = df_sub.groupby("‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì", as_index=False).agg({
            "‡∏û‡∏£‡∏ö.": "sum",
            "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô": "sum",
            "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": "sum",
            "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": "sum"
        })

        df_grouped["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] = round((df_grouped["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] / df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)
        df_grouped["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] = round((df_grouped["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] / df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)

        display_cols = ["‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì", "‡∏û‡∏£‡∏ö.", "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢", "%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"]

        styled = df_grouped[display_cols].style.format({
            "‡∏û‡∏£‡∏ö.": "{:,.4f}",
            "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô": "{:,.4f}",
            "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": "{:,.4f}",
            "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": "{:,.4f}",
            "%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": "{:,.2f}%",
            "%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": "{:,.2f}%"
        }).apply(lambda row: highlight_project(row, disb_thres, spend_thres), axis=1)

        st.dataframe(styled, use_container_width=True)

        # üî¢ ‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î
        total_prb = df_grouped["‡∏û‡∏£‡∏ö."].sum()
        total_after = df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"].sum()
        total_disb = df_grouped["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"].sum()
        total_spend = df_grouped["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"].sum()
        percent_disb = round((total_disb / total_after) * 100, 2) if total_after else 0
        percent_spend = round((total_spend / total_after) * 100, 2) if total_after else 0

        color_disb = "#00FF9F" if percent_disb >= disb_thres else "#FF4B4B"
        color_spend = "#00FF9F" if percent_spend >= spend_thres else "#FF4B4B"

        st.markdown(f"""
        **‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô** | ‡∏û‡∏£‡∏ö.: **{total_prb:,.4f}** | ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô: **{total_after:,.4f}** | 
        ‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢: **{total_disb:,.4f}** | <span style='color:{color_disb}; font-weight:bold;'>%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢: {percent_disb:.2f}%</span> | 
        ‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢: **{total_spend:,.4f}** | <span style='color:{color_spend}; font-weight:bold;'>%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢: {percent_spend:.2f}%</span>
        """, unsafe_allow_html=True)

    # ‚úÖ Tabs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    tab1, tab2, tab3 = st.tabs(["üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°", "üè¢ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥", "üèóÔ∏è ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"])

    # üìä Tab 1: ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
    with tab1:
        show_project_table(df_project, disb_thres=87.67, spend_thres=93.33)

    # üè¢ Tab 2: ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥
    with tab2:
        df_reg = df_project[df_project["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥"]
        if not df_reg.empty:
            show_project_table(df_reg, disb_thres=92, spend_thres=93.67)
        else:
            st.info("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥")

    # üèóÔ∏è Tab 3: ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô
    with tab3:
        df_inv = df_project[df_project["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"]
        if not df_inv.empty:
            show_project_table(df_inv, disb_thres=71.33, spend_thres=92.33)
        else:
            st.info("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô")

    st.markdown("<br>", unsafe_allow_html=True)

#--------------------------------------------------------------
# ‚úÖ SECTION 8: ‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô)
if "8Ô∏è‚É£ ‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô)" in selected_menus:
    st.markdown("## 8Ô∏è‚É£ ‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô)")

    # üîπ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á
    ministry_options = df["‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á"].dropna().unique()
    selected_ministry = st.selectbox("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á", sorted(ministry_options), key="ministry_section8")

    # üîπ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
    df_min = df[df["‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á"] == selected_ministry]
    agency_options = df_min["‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô"].dropna().unique()
    selected_agency = st.selectbox("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", sorted(agency_options))

    # üîπ ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô
    df_agency = df_min[df_min["‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô"] == selected_agency]

    # üîπ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏™‡πà‡∏™‡∏µ
    def highlight_proj_detail(row, category):
        c1 = get_color(row["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"], category, "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢")
        c2 = get_color(row["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"], category, "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢")
        return ["", "", "", "", f"color: {c1}", "", f"color: {c2}"]

    # üîπ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    def show_proj_by_agency(df_sub, category):
        if df_sub.empty:
            st.info("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•")
            return

        df_grouped = df_sub.groupby("‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", as_index=False)[
            ["‡∏û‡∏£‡∏ö.", "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"]
        ].sum(numeric_only=True)

        df_grouped["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] = round((df_grouped["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] / df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)
        df_grouped["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] = round((df_grouped["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] / df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)

        display_cols = ["‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï/‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£", "‡∏û‡∏£‡∏ö.", "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢", "%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"]
        styled = df_grouped[display_cols].style.format({
            "‡∏û‡∏£‡∏ö.": "{:,.4f}",
            "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô": "{:,.4f}",
            "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": "{:,.4f}",
            "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": "{:,.4f}",
            "%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": "{:,.2f}%",
            "%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": "{:,.2f}%"
        }).apply(lambda row: highlight_proj_detail(row, category), axis=1)

        st.dataframe(styled, use_container_width=True)

    # üîπ ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    df_all = df_agency.copy()
    df_reg = df_agency[df_agency["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥"]
    df_inv = df_agency[df_agency["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"]

    # ‚úÖ Tabs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    tab1, tab2, tab3 = st.tabs(["üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°", "üè¢ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥", "üèóÔ∏è ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"])

    with tab1:
        show_proj_by_agency(df_all, "‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°")

    with tab2:
        show_proj_by_agency(df_reg, "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥")

    with tab3:
        show_proj_by_agency(df_inv, "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô")

    st.markdown("<br>", unsafe_allow_html=True)



#--------------------------------------------------------------
# --- SECTION 9: ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏á‡∏≤‡∏ô ---
if "9Ô∏è‚É£ ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏á‡∏≤‡∏ô" in selected_menus:
    st.markdown("## 9Ô∏è‚É£ ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏á‡∏≤‡∏ô")

    selected_dimension = st.selectbox(
        "üîç ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏á‡∏≤‡∏ô",
        sorted(df["‡∏î‡πâ‡∏≤‡∏ô_‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏á‡∏≤‡∏ô"].dropna().unique()),
        key="main_dimension"
    )

    df_dim = df[df["‡∏î‡πâ‡∏≤‡∏ô_‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡∏á‡∏≤‡∏ô"] == selected_dimension].copy()
    df_dim["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] = round((df_dim["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] / df_dim["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)
    df_dim["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] = round((df_dim["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] / df_dim["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)

    def highlight_table(row, disb_thres, spend_thres):
        color_disb = "#00FF9F" if row["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] >= disb_thres else "#FF4B4B"
        color_spend = "#00FF9F" if row["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] >= spend_thres else "#FF4B4B"
        return ["", "", "", "", f"color: {color_disb}", "", f"color: {color_spend}"]

    def show_dimension_table(df_sub, disb_thres, spend_thres, category):
        if df_sub.empty:
            st.info("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•")
            return

        group_cols = ["‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô"]
        sum_cols = ["‡∏û‡∏£‡∏ö.", "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"]
        df_grouped = df_sub.groupby(group_cols, as_index=False)[sum_cols].sum(numeric_only=True)

        df_grouped["%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] = round((df_grouped["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"] / df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)
        df_grouped["%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] = round((df_grouped["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"] / df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"]) * 100, 2)

        display_cols = ["‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô", "‡∏û‡∏£‡∏ö.", "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô", "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢", "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢", "%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"]
        styled = df_grouped[display_cols].style.format({
            "‡∏û‡∏£‡∏ö.": "{:,.4f}",
            "‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô": "{:,.4f}",
            "‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": "{:,.4f}",
            "‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": "{:,.4f}",
            "%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢": "{:,.2f}%",
            "%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢": "{:,.2f}%"
        }).apply(lambda row: highlight_table(row, disb_thres, spend_thres), axis=1)

        st.dataframe(styled, use_container_width=True)

        # üî∏ ‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î
        total_prb = df_grouped["‡∏û‡∏£‡∏ö."].sum()
        total_after = df_grouped["‡∏á‡∏ö‡∏Ø ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô"].sum()
        total_disb = df_grouped["‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢"].sum()
        total_spend = df_grouped["‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢"].sum()
        percent_disb = round((total_disb / total_after) * 100, 2) if total_after else 0
        percent_spend = round((total_spend / total_after) * 100, 2) if total_after else 0

        color_disb_text = "#00FF9F" if percent_disb >= disb_thres else "#FF4B4B"
        color_spend_text = "#00FF9F" if percent_spend >= spend_thres else "#FF4B4B"

        st.markdown(f"""
**‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô** | ‡∏û‡∏£‡∏ö.: **{total_prb:,.4f}** | ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô: **{total_after:,.4f}** | 
‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢: **{total_disb:,.4f}** | <span style='color:{color_disb_text}; font-weight:bold;'>%‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢: {percent_disb:.2f}%</span> | 
‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢: **{total_spend:,.4f}** | <span style='color:{color_spend_text}; font-weight:bold;'>%‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢: {percent_spend:.2f}%</span>
""", unsafe_allow_html=True)

    # üîπ ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    df_dim_reg = df_dim[df_dim["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥"]
    df_dim_inv = df_dim[df_dim["‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥/‡∏•‡∏á‡∏ó‡∏∏‡∏ô"] == "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"]

    # ‚úÖ Tabs ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    tab1, tab2, tab3 = st.tabs(["üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°", "üè¢ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥", "üèóÔ∏è ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô"])

    with tab1:
        show_dimension_table(df_dim, disb_thres=87.67, spend_thres=93.33, category="‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°")

    with tab2:
        show_dimension_table(df_dim_reg, disb_thres=92, spend_thres=93.67, category="‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥")

    with tab3:
        show_dimension_table(df_dim_inv, disb_thres=71.33, spend_thres=92.33, category="‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô")


#--------------------------------------------------------------

# --- Section: Footer Contact and Credits ---

# üîπ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ô Sidebar ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
with st.sidebar:
    show_footer = st.checkbox("üìû‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ / Contact", value=True)

# üîπ ‡πÅ‡∏™‡∏î‡∏á footer ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
if show_footer:
    col1, col2, col3 = st.columns(3)

    with col1:
        st.markdown("""
        #### Contact us  
        üìû **Call**: +66 2 242 5900 ext. 4121  
        üìß **Email**: [pbo@parliament.go.th](mailto:pbo@parliament.go.th)  
        üí¨ **LINE ID**: @thaipbo
        """)

    with col2:
        st.markdown("""
        #### ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°  
        üìû **‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠**: +66 2 242 5900 ‡∏ï‡πà‡∏≠ 4121  
        üìß **Email**: [pbo@parliament.go.th](mailto:pbo@parliament.go.th)  
        üí¨ **LINE ID**: @thaipbo
        """)

    with col3:
        st.markdown("""
        #### ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö  
        üîπ ‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå: ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Ç‡∏≠‡∏á‡∏£‡∏±‡∏ê‡∏™‡∏†‡∏≤ (PBO)  
        üîπ ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö: **‡∏Å‡∏∏‡∏•‡∏ò‡∏¥‡∏î‡∏≤ ‡∏™‡∏°‡∏®‡∏£‡∏µ** ‡πÅ‡∏•‡∏∞ **‡∏®‡∏∏‡∏†‡∏¥‡∏Å‡∏≤ ‡∏ï‡∏£‡∏µ‡∏£‡∏±‡∏ï‡∏ô‡πÑ‡∏û‡∏ö‡∏π‡∏•‡∏¢‡πå**  
        üîπ Code writer: **‡∏Å‡∏∏‡∏•‡∏ò‡∏¥‡∏î‡∏≤ ‡∏™‡∏°‡∏®‡∏£‡∏µ (70%)** ‡πÅ‡∏•‡∏∞ **ChatGPT (30%)**
        """)




























































































































